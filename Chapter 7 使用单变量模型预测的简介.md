# Chapter 7 使用单变量模型预测

## 使用差分单积自回归滑动平均（ARIMA）模型进行预测

7.1先前章节介绍的单变量模型的重要特征，是他们提供的观测序列未来值的预测能力。预测有两个方面：序列的未来值，及点预测的预测误差。然后，可以将这个预测误差用于构建预测区间，检验预测的精度。因此，该设置类似于经典统计问题中估计模型未知参数并提供参数置信区间。

预测时通常没有意识到的是，用于构建点和区间预测的模型的类型必定会确定这些预测的属性。因此，从不正确或设定错误的模型预测可能会导致预测不准确以及错误地测量预测精度。



7.2为了形式化预测问题，假设我们有一个实现$(x_{1-d},x_{2-d},...,x_T)$,来自一般的ARIMA（p，d，q）过程:

$\phi(B)\triangledown^dx_t=\theta_0+\theta(B)a_t$(7.1)

并且我们希望预测未来值$x_{T+h}$，h被称为超前时间或预测范围。如果我们让

$\alpha(B)=\phi(B)\triangledown^d=(1-\alpha_1B-\alpha_2B^w-...--\alpha_{p+d}B^{p+d})$

则（7.1）在时间T+h变为

$\alpha(B)x_{T+h}=\theta_0+\theta(B)a_{T+h}$

也就是，

$x_{T+h}=\alpha_1x_{T+h-1}+\alpha_2x_{T+h-2}+...+\alpha_{p+d}x_{T+h-p-d}+\theta_0+a_{T+h}-\theta_1a_{T+h-1}-...-\theta_qa_{T+h-q}$

显然，从T+1开始的观测没有提供，但是在时间T（称为原点）对$x_{T+h}$的最小均方误差（MMSE）预测，表示为$f_{T,h}$，由条件期望给出

$f_{T,h}=E(\alpha_1x_{T+h-1}+\alpha_2x_{T+h-2}+...+\alpha_{p+d}x_{T+h-p-d}+\theta_0+a_{T+h}-\theta_1a_{T+h-1}-...-\theta_qa_{T+h-q}|x_T,x_{T-1},...)$（7.2）

这样的预测可以最小化前h步预测误差$e_{T,h}=x_{T+h}-f_{T,h}$的方差。即它将使$E(e_{T,h}^2)$最小。现在有

$\begin{equation}E(x_{T+j}|x_T,x_{T-1},...)=\left\{ \begin{aligned} x_{T+j} &&j\le0 \\ f_{T,h} && j>0 \end{aligned} \right. \end{equation}$

和

$\begin{equation}E(a_{T+j}|x_T,x_{T-1},...)=\left\{ \begin{aligned} a_{T+j} &&j\le0 \\ 0 && j>0 \end{aligned} \right. \end{equation}$

因此，要评估$f_{T,h}$，我们要做的是：（1）用已知值$x_{T+h}和a_{T+j}$替换过去的期望$j\le0$（2）用预测值$f_{T,j}和0$替换未来期望（j\>0）。



7.3我们将使用三个过程来说明该程序。首先考虑AR（2）过程$(1-\phi_1B-\phi_2B^2)x_t=\theta_0+a_t$，所以$\alpha(B)=(1-\phi_!B-\phi_2B^2)$。这里

$x_{T+h}=\phi_1x_{T+h-1}+\phi_2x_{T+h-2}+\theta_0+a_{T+h}$

因此，对于h=1，我们有

$f_{T,1}=\phi_1x_T+\phi_2x_{T-1}+\theta_0$

并且，对于h=2，

$f_{T,2}=\phi_1f_{T,1}+\phi_2x_T+\theta_0$

对于h\>2

$f_{T,h}=\phi_1f_{T,h-1}+\phi_2f_{T,h-2}+\theta_0$

可以获得$f_{T,h}$的替代表达式，先写出

$f_{T,h}=(\phi_1+\phi_2)f_{T,h-1}-\phi_2(f_{T,h-1}-f_{T,h-2})+\theta_0$

通过反复替换，我们得到

$f_{T,h}=(\phi_1+\phi_2)^hx_T-\phi_2\sum_{j=0}^{h-1}(\phi_1+\phi_2)^j(f_{T,h-1-j}-f_{T,h-2-j})+\theta_0\sum_{j=0}^{h-1}(\phi_1+\phi_2)^j$

根据惯例，我们取$f_{T,0}=x_T,f_{T,-1}=x_{T-1}$。因此，对于平稳过程，即对于$\phi_1+\phi_2<1,|\phi_2|<1$

$f_{T,h}\to \frac{\theta_0}{1-\phi_1-\phi_2}=E(x_t)=\mu,h\to\infty$

因此对于长超前时间而言，未来观察的最佳预测最终将成为该过程的均值。这是一个普遍的结果：对于所有平稳过程，预测最终将收敛于过程的平均值，反映此类模型的均值回归特性。当然，短期（小h）预测可能与平均值有所不同，因为它们响应实现的最近发展，且预测均值恢复的速度反过来将取决于序列的自相关强度（在AR（2）情况下，$\phi_1+\phi_2$越接近一，均值恢复越慢）。



7.4接下来考虑ARIMA（0,1,1）模型$\triangledown x_t=(1-\theta_1B)a_t$。这里$\alpha(B)=(1-B)$，因此

$x_{T+h}=x_{T+h-1}+a_{T+h}-\theta_1a_{T+h-1}$

对于h=1，我们有

$f_{T,1}=x_T-\theta_1a_T$

对于h=2

$f_{T,2}=f_{T,1}=x_T-\theta_1a_T$

一般的

$f_{T,h}=f_{T,h-1}=f_{T,1},h>1$

因此，对于所有超前时间，来自起点T的预测将遵循平行于时间轴的一条直线并经过$f_{T,1}$。注意，既然

$f_{T,h}=x_T-\theta_1a_T$

且

$a_T=(1-B)(1-\theta_1B)^{-1}x_T$

h步超前的预测可以写成

$f_{T,h}=(1-\theta_1)(1-\theta_1B)^{-1}x_T=(1-\theta_1)(x_T+\theta_1x_{T-1}+\theta_1^2x_{T-2}+...)$

因此，对于x的所有未来值的预测是当前值和过去值的加权移动平均值，且权重按几何级数下降（这也称为指数加权移动平均）。

ARIMA（0,1,1）模型的非平稳性质使得它没有均值恢复，所有超前时间的预测均保持在$f_{T,1}$。注意如果$\theta_1=0$,则该模型是一个纯粹的随机游走，对于所有h，$f_{T,h}=x_T$。也就是说，对于没有漂移的随机游走，所有超前时间的最佳预测是序列的当前值。

如果有漂移，那么我们有

$\triangledown x_t=\theta_0+(1-\theta_1B)a_t$

和

$x_{T+h}=x_{T+h-1}+\theta_0+a_{T+h}-\theta_1a_{T+h-1}$

对于h=1，我们现在有

$f_{T,1}=x_T+\theta_0-\theta_1a_T$

对于h=2

$f_{T,2}=f_{T,1}+\theta_0=x_T+2\theta_0-\theta_1a_T$

一般的

$f_{T,h}=f_{T,h-1}+\theta_0=x_T+h\theta_0-\theta_1a_T,h>1$

因此，将漂移包含在模型中，导致将线性趋势引入预测。如果再次$\theta_1=0$时，我们得到有漂移随机游走，则预测序列是从最近一次观测值产生的线性趋势，且最近一次观测的斜率由漂移给出。



7.5最后，我们考虑ARIMA（0,2,2）过程$\triangledown^2 x_t=(1-\theta_1B-\theta_2B^2)a_t$，这里$\alpha(B)=(1-B)^2=(1-2B+B^2)$，因此：

$x_{T+h}=2x_{T+h-1}-x_{T+h-2}+a_{T+h}-\theta_1a_{T+h-1}-\theta_2a_{T+h-2}$

对于h=1，我们现在有

$f_{T,1}=2x_T-x_{T-1}-\theta_1a_T-\theta_2a_{T-1}$

对于h=2

$f_{T,2}=2f_{T,1}-x_T-\theta_2a_T$

对于h=3

$f_{T,3}=2f_{T,2}-f_{T,1}$

因此对于$h\ge3$

$f_{T,h}=2f_{T,h-1}-f_{T,h-2}=(h-1)f_{T,2}-(h-2)f_{T,1}$

因此，对于所有超前时间，来自原点T的预测将遵循一条通过预测$f_{T,1}和f_{T,2}$的直线。



7.6这些结果可以推广到d不超过2的ARIMA（p，d，q）过程。自回归和滑动平均成分对短期预测的影响消散后，长期预测行为取决于差分阶数和该过程中是否包含截距。对于平稳过程，预测最终将恢复为过程的均值，如果不包括截距，则为零。对于$I(1)$过程，长期预测如果没有截距，则将是水平的，截距为非零时遵循线性趋势。对于$I(2)$过程，如果没有截距，则自动插入线性趋势。因此，$I(2)$过程将向预测中引入二次趋势，在大多数应用中会被认为是不合适的；它的缺失与截距的估计在拟合$I(2)$模型中不显著这个典型的发现是一致的。



7.7  7.2中定义的原点T的h步超前预测误差，可以表示为

$e_{T,h}=x_{T+h}-f_{T,h}=a_{T+h}+\psi_1a_{T+h-1}+...+\psi_{h-1}a_{T+1}$(7.3)

其中$\psi_1,...\psi_{h-1}$是$\psi(B)=\alpha^{-1}(B)\theta(B)$中前h-1个ψ权重。因此，预测误差是时间T之后进入系统的不可观测的未来冲击的线性组合，尽管提前一步预测误差简单表示为

$e_{T,1}=x_{T,1}-f_{T,1}=a_{T+1}$

因此，对于MMSE预测，提前一步的预测误差必须不相关。但是，在不同远点的h步提前预测并非不相关，相同原点的不同的超前时间的预测也并非不相关。



7.8从（7.3），预测误差的方差为

$V(e_{T,h})=\sigma^2(1+\psi_1^2+\psi_2^2+...+\psi_{h-1}^2)$(7.4)

对于AR（2）模型，我们有$\psi_1=\phi_1,\psi_2=\phi_1^2+\phi_2$，对于j>2，$\psi_j=\phi_1\psi_{j-1}+\phi_2\psi_{j-2}$。由于我们假设平稳，这些ψ权重绝对收敛，这意味着$\sum_{j=1}^h\psi_j^2<\infty$。因此$V(e_{T,h})$收敛到一个有限值，即关于最终预测μ的过程的方差。那么，对于平稳模型，预测误差方差受该序列的内在可变性限制。



7.9对于ARIMA（0,1,1）过程，$\psi_j=1-\theta,j=1,2,...$。因此，我们有

$V(e_{T,h})=\sigma^2(1+(h-1)(1-\theta)^2)$

这是h的线性函数，因此预测不确定性随预测范围线性增加。同样，ARIMA（0,2,2）模型ψ权重为$\psi_j=1+\theta_2+j(1-\theta_1-\theta_2),j=1,2,...$，h步超前预测误差方差为

$V(e_{T,h})=\sigma^2(1+(h-1)(1+\theta_2)^2+(1/6)h(h-1)(2h-1)(1-\theta_1-\theta_2)^2+h(h-1)(1+\theta_2)(1-\theta_1-\theta_2))$

这是h的三次函数，因此预测不确定性通常随着预测范围的增加而增加。



7.10这些示例说明了差分阶数（等效为单积的阶数）不仅决定了连续预测之间的相关性，还有相关的误差的行为。获得了预测误差方差$V(e_{T,h})$，一个$100(1-\varsigma)%$预测区间可以构造为$f_{T,h}\pm z_{\varsigma/2}\sqrt{V(e_{T,h})}$，其中$z_{\varsigma/2}$是标准正态分布的ς/2分位数，例如，$z_{0.025}=1.96$。



## 预测趋势平稳过程

7.11现在考虑趋势平稳（TS）过程

$x_t=\beta_0+\beta_1t+\varepsilon_t,\phi(B)\varepsilon_t=\theta(B)a_t$(7.5)

在时间T，$x_{T+h}$的预测是

$f_{T,h}=\beta_0+\beta_1(T+h)+g_{T,h}$

其中$g_{T,h}$是$\varepsilon_{T+h}$的预测，从（7.2）由下式给出

$g_{T,h}=E(\phi_1\varepsilon_{T+h-1}+\phi_2\varepsilon_{T+h-2}+...+\phi_{p}x_{T+h-p}+a_{T+h}-\theta_1a_{T+h-1}-...-\theta_qa_{T+h-q}|\varepsilon_T,\varepsilon_{T-1},...)$

既然假设$\varepsilon_t$为平稳的，我们知道$g_{T,h}\to0$，当$h\to\infty$。因此，对于大的h，$f_{T,h}=\beta_0+\beta_1(T+h)$

和预测将简单地由外推线性趋势给出。对于较小的h，还将存在分量$g_{T,h}$，但随着h的增加而消失。预测误差为

$e_{T,h}=x_t-f_{T,h}=\varepsilon_{T+h}-g_{T,h}$

因此，任何TS预测中的不确定性完全是由于预测ARMA分量的误差引起。因此，预测误差方差以$\varepsilon_t$的样本方差为界，与ARIMA（p，2，q）过程和带截距的ARIMA（p，1，q）的误差方差相比，还具有线性趋势的预测，但误差方差无界。在最简单的情况，$\varepsilon_t$是白噪声，一个TS过程的所有的预测具有相同的误差方差，$\sigma^2$。
